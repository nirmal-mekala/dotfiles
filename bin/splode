#!/usr/bin/env bash

set -euo pipefail

if [[ $# -lt 1 ]]; then
  echo "Usage: splode <directory>" >&2
  exit 1
fi

dir="$1"

[[ -d "$dir" ]] || {
  echo "Error: '$dir' is not a directory." >&2
  exit 1
}

files=$(find "$dir" -type f \
  -not -path '*/.git/*' \
  -not -path '*/node_modules/*')
count=$(printf "%s\n" "$files" | wc -l)

if (( count == 0 )); then
  echo "No files found in '$dir'." >&2
  exit 1
fi


if (( count > 20 )); then
  echo "You are about to open $count files in Neovim tabs."
  read -rp "Are you sure you want to continue? [y/N] " confirm
  if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
    echo "Aborted."
    exit 0
  fi
fi

nvim -p $(printf "%s\n" "$files")
